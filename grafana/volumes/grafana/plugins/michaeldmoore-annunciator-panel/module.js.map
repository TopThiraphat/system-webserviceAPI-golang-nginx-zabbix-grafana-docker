{"version":3,"sources":["../src/module.js"],"names":["isNumber","n","isNaN","parseFloat","isFinite","MetricsPanelCtrl","_","$","kbn","TimeSeries","getTemplateSrv","PanelEvents","templateSrv","AnnunciatorPanelCtrl","$scope","$injector","panelDefaults","defaults","panel","events","on","dataReceived","onDataReceived","bind","dataError","onDataError","render","onRender","dataSnapshotLoad","onDataSnapshotLoad","editModeInitialized","onInitEditMode","err","errorMessage","status","statusText","seriesList","snapshotData","metricNames","fontSizes","fontSizes0","concat","displayStates","displayStates1","unitFormats","getUnitFormats","addEditorTab","subItem","Metric","Format","value","valueRegion","UpperLimit","DisplayOption","Value","UpperWarning","LowerLimit","LowerWarning","metric","displayAttributes","color","Color","displayOption","flash","getValueRegion","data","html","Prefix","Text","FontSize","getTextSpan","getValueSpan","Decimals","Postfix","buildLimitsHtml","buildValueHtml","elem","sparkline","show","addSparkline","className","fontSize","text","style","replace","decimals","getDisplayAttributesForValue","formatValue","OKLowerLimit","Number","OKUpperLimit","MetricValueRange","dataList","length","datapoints","dataPoints","filter","dp","range","from","to","series","map","seriesHandler","setValues","setOKValueRange","buildHtml","ctrl","renderingCompleted","seriesData","alias","target","flotpairs","getFlotPairs","nullPointMode","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","lastPoint","last","lastValue","isArray","isString","valueFormatted","escape","valueRounded","stats","Name","roundValue","width","setTimeout","height","plotCanvas","plotCss","position","full","bottom","left","dynamicHeightMargin","round","css","options","legend","lines","fill","lineWidth","fillColor","yaxes","xaxis","mode","min","valueOf","grid","hoverable","find","append","plotSeries","lineColor","plot","refresh","scope","attrs","panelContentElem","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["/*jshint esversion: 6 */\n/*jshint -W087 */\nimport {\n  MetricsPanelCtrl\n} from 'app/plugins/sdk';\n\nimport \"./css/annunciator-panel.css!\";\n\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series2';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { PanelEvents } from \"@grafana/data\";\n\nconst templateSrv = getTemplateSrv();\n\nfunction isNumber(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n\nclass AnnunciatorPanelCtrl extends MetricsPanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector) {\n    super($scope, $injector);\n\n    var panelDefaults = {\n      \"LowerLimit\": {\n        \"DisplayOption\": \"disabled\",\n        \"Color\": \"rgb(2, 17, 249)\",\n        \"Value\": 20,\n        \"Decimals\": 1,\n        \"FontSize\": \"50%\"\n      },\n      \"LowerWarning\": {\n        \"DisplayOption\": \"disabled\",\n        \"Color\": \"rgb(9, 115, 102)\",\n        \"Value\": 25\n      },\n      \"Metric\": {\n        \"Name\": \"current\",\n        \"Format\": \"percent\",\n        \"Color\": \"rgb(2, 247, 2)\",\n        \"Decimals\": 4,\n        \"FontSize\": \"100%\"\n      },\n      \"UpperWarning\": {\n        \"DisplayOption\": \"disabled\",\n        \"Color\": \"rgb(247, 2, 2)\",\n        \"Value\": 75\n      },\n      \"UpperLimit\": {\n        \"DisplayOption\": \"disabled\",\n        \"Color\": \"rgb(247, 90, 7)\",\n        \"Value\": 80,\n        \"Decimals\": 2,\n        \"FontSize\": \"50%\"\n      },\n      \"Prefix\": {\n        \"Text\": \"\",\n        \"FontSize\": \"hide\",\n      },\n      \"Postfix\": {\n        \"Text\": \"\",\n        \"FontSize\": \"hide\",\n      },\n      \"sparkline\": {\n        \"fillColor\": \"rgba(19, 193, 91, 0.32)\",\n        \"full\": false,\n        \"lineColor\": \"rgb(145, 200, 16)\",\n        \"show\": true\n      }\n    };\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on(\n      PanelEvents.dataReceived,\n      this.onDataReceived.bind(this),\n      $scope\n    );\n\n    this.events.on(\n      PanelEvents.dataError,\n      this.onDataError.bind(this),\n      $scope\n    );\n\n    this.events.on(\n      PanelEvents.render,\n      this.onRender.bind(this)\n    );\n\n    this.events.on(\n      PanelEvents.dataSnapshotLoad,\n      this.onDataSnapshotLoad.bind(this)\n    );\n\n    this.events.on(\n      PanelEvents.editModeInitialized,\n      this.onInitEditMode.bind(this)\n    );\n  }\n\n  onDataError(err) {\n    this.errorMessage = 'Query Failure : ' + err.status + ', ' + err.statusText;\n    this.seriesList = [];\n    this.render([]);\n  }\n\n  onDataSnapshotLoad(snapshotData) {\n    this.onDataReceived(snapshotData);\n  }\n\n  onInitEditMode() {\n    this.metricNames = ['min', 'max', 'avg', 'current', 'total', 'first', 'delta', 'diff', 'range'];\n    this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%',\n      '200%', '230%', '260%', '300%', '340%', '380%', '440%', '500%', '600%', '800%', '1000%'];\n    this.fontSizes0 = ['hide'].concat(this.fontSizes);\n    this.displayStates = ['disabled', 'static'];\n    this.displayStates1 = this.displayStates.concat(['flash', 'shock & awe']);\n    this.unitFormats = kbn.getUnitFormats();\n    this.addEditorTab('Options', 'public/plugins/michaeldmoore-annunciator-panel/options.html', 2);\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.Metric.Format = subItem.value;\n    this.render();\n  }\n\n  getValueRegion(value) {\n    var valueRegion = \"OK\";\n\n    if (this.panel.UpperLimit.DisplayOption != 'disabled') {\n      if (value >= this.panel.UpperLimit.Value)\n        valueRegion = \"UpperLimit\";\n      else if (this.panel.UpperWarning.DisplayOption != 'disabled' && (value >= this.panel.UpperWarning.Value))\n        valueRegion = \"UpperWarning\";\n    }\n\n    if (this.panel.LowerLimit.DisplayOption != 'disabled') {\n      if (value <= this.panel.LowerLimit.Value)\n        valueRegion = \"LowerLimit\";\n      else if (this.panel.LowerWarning.DisplayOption != 'disabled' && (value <= this.panel.LowerWarning.Value))\n        valueRegion = \"LowerWarning\";\n    }\n\n    return valueRegion;\n  }\n\n  getDisplayAttributesForValue(value, metric) {\n    var displayAttributes = {};\n    var color = this.panel.Metric.Color;\n    var displayOption = this.panel.Metric.DisplayOption;\n    var flash = false;\n\n    var valueRegion = this.getValueRegion(this.data.value);\n    switch (valueRegion) {\n      case \"UpperLimit\":\n        color = this.panel.UpperLimit.Color;\n        displayOption = this.panel.UpperLimit.DisplayOption;\n        break;\n\n      case \"UpperWarning\":\n        color = this.panel.UpperWarning.Color;\n        displayOption = this.panel.UpperWarning.DisplayOption;\n        break;\n\n      case \"LowerWarning\":\n        color = this.panel.LowerWarning.Color;\n        displayOption = this.panel.LowerWarning.DisplayOption;\n        break;\n\n      case \"LowerLimit\":\n        color = this.panel.LowerLimit.Color;\n        displayOption = this.panel.LowerLimit.DisplayOption;\n        break;\n    }\n\n    switch (metric) {\n      case \"UpperLimit\":\n        color = this.panel.UpperLimit.Color;\n        if (displayOption == \"shock & awe\")\n          displayOption = \"flash\";\n        if (valueRegion != \"UpperLimit\")\n          displayOption = \"static\";\n        break;\n\n      case \"LowerLimit\":\n        color = this.panel.LowerLimit.Color;\n        if (displayOption == \"shock & awe\")\n          displayOption = \"flash\";\n        if (valueRegion != \"LowerLimit\")\n          displayOption = \"static\";\n        break;\n    }\n\n    displayAttributes.color = color;\n    displayAttributes.displayOption = displayOption;\n\n    return displayAttributes;\n  }\n\n  buildValueHtml() {\n    var html = '';\n\n    html += \"<div class='michaeldmoore-annunciator-panel-value-container'>\";\n    if (this.panel.Prefix.Text != '' && this.panel.Prefix.FontSize != 'hide')\n      html += this.getTextSpan('michaeldmoore-annunciator-panel-prefix', this.panel.Prefix.FontSize, this.panel.Prefix.Text, {});\n\n    html += this.getValueSpan('michaeldmoore-annunciator-panel-value', this.panel.Metric.FontSize, this.panel.Metric.Decimals, this.data.value, \"Value\");\n\n    if (this.panel.Postfix.Text != '' && this.panel.Postfix.FontSize != 'hide')\n      html += this.getTextSpan('michaeldmoore-annunciator-panel-postfix', this.panel.Postfix.FontSize, this.panel.Postfix.Text, {});\n\n    html += \"</div>\";\n\n    return html;\n  }\n\n  buildLimitsHtml() {\n    var html = '';\n\n    if (this.panel.UpperLimit.DisplayOption != 'disabled' || this.panel.LowerLimit.DisplayOption != 'disabled') {\n      html += \"<div class='michaeldmoore-annunciator-panel-limits-container'>\";\n\n      if (this.panel.LowerLimit.DisplayOption != 'disabled' && (this.panel.LowerLimit.FontSize != 'hide'))\n        html += this.getValueSpan('michaeldmoore-annunciator-panel-lower-limit', this.panel.LowerLimit.FontSize, this.panel.LowerLimit.Decimals, this.panel.LowerLimit.Value, \"LowerLimit\");\n\n      if (this.panel.UpperLimit.DisplayOption != 'disabled' && (this.panel.UpperLimit.FontSize != 'hide'))\n        html += this.getValueSpan('michaeldmoore-annunciator-panel-upper-limit', this.panel.UpperLimit.FontSize, this.panel.UpperLimit.Decimals, this.panel.UpperLimit.Value, \"UpperLimit\");\n\n      html += \"</div>\";\n\n      html += \"<div style='float:none;'/>\";\n    }\n    return html;\n  }\n\n  buildHtml() {\n    var html = \"<div class='michaeldmoore-annunciator-panel-container' style='height:100%;'>\";\n\n    if (this.data == null || this.data.value == null)\n      this.errorMessage = 'No data';\n\n    if (this.errorMessage) {\n      html += '<div class=\"michaeldmoore-annunciator-panel-centered\">' + this.errorMessage + '</div>';\n    }\n    else {\n      html += this.buildLimitsHtml();\n      if (isNumber(this.data.value))\n        html += this.buildValueHtml();\n    }\n\n    html += \"</div>\";\n\n    this.elem.html(html);\n\n    if (this.panel.sparkline.show) {\n      this.addSparkline();\n    }\n  }\n\n  getTextSpan(className, fontSize, text, displayAttributes) {\n    var style = '';\n\n    if (fontSize)\n      style += \"font-size:\" + fontSize + \";\";\n\n    if (displayAttributes && displayAttributes.color)\n      style += \"color:\" + displayAttributes.color + \";\";\n\n    if (style)\n      style = ' style=\"' + style + '\"';\n\n    if (displayAttributes && displayAttributes.displayOption)\n      className += \" michaeldmoore-annunciator-\" + displayAttributes.displayOption.replace(' & ', 'and');\n\n    return '<span class=\"' + className + '\"' + style + '>' + text + '</span>';\n  }\n\n  getValueSpan(className, fontSize, decimals, value, metric) {\n    var displayAttributes = this.getDisplayAttributesForValue(value, metric);\n    return this.getTextSpan(className, fontSize, this.formatValue(value, decimals), displayAttributes);\n  }\n\n  setOKValueRange() {\n    var OKLowerLimit;\n    if (this.panel.LowerLimit.DisplayOption != 'disabled') {\n      if (isNumber(this.panel.LowerLimit.Value)) {\n        if (this.panel.LowerWarning.DisplayOption != 'disabled') {\n          if (isNumber(this.panel.LowerWarning.Value))\n            if (Number(this.panel.LowerWarning.Value) > Number(this.panel.LowerLimit.Value))\n              OKLowerLimit = this.panel.LowerWarning.Value;\n            else\n              this.errorMessage = 'Warning : LowerWarning must be greater than LowerLimit';\n          else\n            this.errorMessage = 'Warning : LowerWarning is non-numeric';\n        } else\n          OKLowerLimit = this.panel.LowerLimit.Value;\n      } else {\n        this.errorMessage = 'Warning : LowerLimit is non-numeric';\n      }\n    }\n\n    var OKUpperLimit;\n    if (this.panel.UpperLimit.DisplayOption != 'disabled') {\n      if (isNumber(this.panel.UpperLimit.Value)) {\n        if (this.panel.UpperWarning.DisplayOption != 'disabled') {\n          if (isNumber(this.panel.UpperWarning.Value))\n            if (Number(this.panel.UpperWarning.Value) < Number(this.panel.UpperLimit.Value))\n              OKUpperLimit = this.panel.UpperWarning.Value;\n            else\n              this.errorMessage = 'Warning : UpperWarning must be less than UpperLimit';\n          else\n            this.errorMessage = 'Warning : UpperWarning is non-numeric';\n        } else\n          OKUpperLimit = this.panel.UpperLimit.Value;\n      } else {\n        this.errorMessage = 'Warning : UpperLimit is non-numeric';\n      }\n    }\n\n    if (isNumber(OKLowerLimit) && isNumber(OKUpperLimit)) {\n      if (OKUpperLimit > OKLowerLimit) {\n        this.panel.MetricValueRange = OKLowerLimit + ' -> ' + OKUpperLimit;\n      } \n      else {\n        this.errorMessage = 'Warning : UpperWarning/limit must be more than LowerWarning/Limit';\n        this.panel.MetricValueRange = '?????';\n      }\n    }\n    else if (isNumber(OKLowerLimit))\n      this.panel.MetricValueRange = '> ' + OKLowerLimit;\n    else if (isNumber(OKUpperLimit))\n      this.panel.MetricValueRange = '< ' + OKUpperLimit;\n    else\n      this.panel.MetricValueRange = '';\n  }\n\n  onRender() {\n    var data = {};\n    if (this.dataList.length > 0) {\n      this.dataList[0].datapoints = this.dataPoints.filter(dp => dp[1] >= this.range.from && dp[1] <= this.range.to);\n      if (this.dataList[0].datapoints.length > 0) {\n        this.series = this.dataList.map(this.seriesHandler.bind(this));\n        this.setValues(data);\n      }\n    }\n\n    this.data = data;\n\n    this.setOKValueRange();\n    this.buildHtml();\n    this.ctrl.renderingCompleted();\n    delete this.errorMessage;\n  }\n\n\n  onDataReceived(dataList) {\n    this.dataList = dataList;\n    if (dataList.length > 0) {\n      this.dataPoints = dataList[0].datapoints;\n    }\n    this.render();\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  getDecimalsForValue(value, decimals) {\n    if (_.isNumber(decimals)) {\n      return {\n        decimals: decimals,\n        scaledDecimals: null\n      };\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec),\n      norm = delta / magn, // norm is between 1.0 and 10.0\n      size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) {\n      dec = 0;\n    }\n\n    var result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n    return result;\n  }\n\n  formatValue(value, decimals) {\n    // crude work-around for kbn formatting function error - preserve decimal places even for whole numbers\n    //if (value == 0 && decimals > 0)\n    //    value += 0.000000000000001;\n    var decimalInfo = this.getDecimalsForValue(value, decimals);\n    var formatFunc = kbn.valueFormats[this.panel.Metric.Format];\n    return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n  }\n\n  setValues(data) {\n    data.flotpairs = [];\n\n    //if (this.series.length > 1) {\n    //  this.errorMessage = 'Multiple Series Error : query returns ' + this.series.length + ' series. Panel expects a single series';\n    //}\n\n    if (this.series && this.series.length > 0) {\n      var lastPoint = _.last(this.series[0].datapoints);\n      var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\n\n      if (_.isString(lastValue)) {\n        data.value = 0;\n        data.valueFormatted = _.escape(lastValue);\n        data.valueRounded = 0;\n      } else {\n        data.value = this.series[0].stats[this.panel.Metric.Name];\n        data.flotpairs = this.series[0].flotpairs;\n\n        if (data == null || data.value == null) {\n          data.value = 0.0;\n        }\n\n        var decimalInfo = this.getDecimalsForValue(data.value, this.panel.Metric.Decimals);\n        var formatFunc = kbn.valueFormats[this.panel.Metric.Format];\n        data.valueFormatted = formatFunc(data.value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        data.valueRounded = kbn.roundValue(data.value, decimalInfo.decimals);\n      }\n\n      if (data == null || data.value == null) {\n        data.value = 0.0;\n      }\n    }\n  }\n\n  addSparkline() {\n    if (this.elem == null || this.elem.width() < 10) {\n      // element has not gotten it's width yet\n      // delay sparkline render\n      setTimeout(this.addSparkline, 30);\n      return;\n    }\n\n    var width = this.elem.width() + 20;\n    var height = this.elem.height();\n    var plotCanvas = $('<div></div>');\n    var plotCss = {};\n    plotCss.position = 'absolute';\n\n    if (this.panel.sparkline.full) {\n      plotCss.bottom = '5px';\n      plotCss.left = '-5px';\n      plotCss.width = (width - 10) + 'px';\n      var dynamicHeightMargin = height <= 100 ? 5 : (Math.round((height / 100)) * 15) + 5;\n      plotCss.height = (height - dynamicHeightMargin) + 'px';\n    } else {\n      plotCss.bottom = \"0px\";\n      plotCss.left = \"-5px\";\n      plotCss.width = (width - 10) + 'px';\n      plotCss.height = Math.floor(height * 0.25) + 'px';\n    }\n\n    plotCanvas.css(plotCss);\n\n    var options = {\n      legend: {\n        show: false\n      },\n      series: {\n        lines: {\n          show: true,\n          fill: 1,\n          lineWidth: 1,\n          fillColor: this.panel.sparkline.fillColor,\n        },\n      },\n      yaxes: {\n        show: false\n      },\n      xaxis: {\n        show: false,\n        mode: \"time\",\n        min: this.ctrl.range.from.valueOf(),\n        max: this.ctrl.range.to.valueOf(),\n      },\n      grid: {\n        hoverable: false,\n        show: false\n      },\n    };\n\n    this.elem.find('.michaeldmoore-annunciator-panel-container').append(plotCanvas);\n\n    var plotSeries = {\n      data: this.data.flotpairs,\n      color: this.panel.sparkline.lineColor\n    };\n\n    $.plot(plotCanvas, [plotSeries], options);\n  }\n\n  onConfigChanged() {\n    this.refresh();\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.ctrl = ctrl;\n    this.elem = elem;\n\n    // for backward compatability (grafana 6.6.0 and earlier)\n    var panelContentElem = elem.find('.panel-content');\n    if (panelContentElem.length)\n      this.elem = panelContentElem;\n  }\n}\n\nAnnunciatorPanelCtrl.templateUrl = 'module.html';\n\nexport {\n  AnnunciatorPanelCtrl as PanelCtrl\n};"]}