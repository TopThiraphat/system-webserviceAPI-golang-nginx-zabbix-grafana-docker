zabbix_export:
  version: '6.4'
  media_types:
    - name: 'Line Notify'
      type: WEBHOOK
      parameters:
        - name: Message
          value: '{ALERT.MESSAGE}'
        - name: Subject
          value: '{ALERT.SUBJECT}'
        - name: To
          value: '{ALERT.SENDTO}'
      script: |
        try {
            var params = JSON.parse(value);
            var response,
            request = new HttpRequest();
            if (typeof params.HTTPProxy === 'string' && params.HTTPProxy.trim() !== '') {
                request.setProxy(params.HTTPProxy);
            }
            request.addHeader('Content-Type: application/x-www-form-urlencoded');
            request.addHeader('Authorization: Bearer ' + params.To);
            var message = params.Subject+'\n'+params.Message;
            response = request.post('https://notify-api.line.me/api/notify', 'message='+encodeURIComponent(message));
            if (request.getStatus() !== 200) {
                throw response;
            }
        } catch (error) {
            response = error;
        }
        return JSON.stringify(response);
      message_templates:
        - event_source: TRIGGERS
          operation_mode: PROBLEM
          subject: 'üî¥ [{EVENT.STATUS}]'
          message: |
            ID : {EVENT.ID}
            ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ : {EVENT.NAME}
            ‡∏£‡∏∞‡∏ö‡∏ö : {HOST.NAME}
            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á : {EVENT.SEVERITY}
            
            ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 
            ‡πÄ‡∏ß‡∏•‡∏≤ :  {EVENT.TIME} 
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà :  {EVENT.DATE}
            
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° :
            {$ZABBIX.URL}/tr_events.php?triggerid={TRIGGER.ID}&eventid={EVENT.ID}
        - event_source: TRIGGERS
          operation_mode: RECOVERY
          subject: 'üü¢ [{EVENT.STATUS}]'
          message: |
            ID : {EVENT.ID}
            ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ : {EVENT.NAME}
            ‡∏£‡∏∞‡∏ö‡∏ö : {HOST.NAME}
            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á : {EVENT.SEVERITY}
            
            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤
            ‡πÄ‡∏ß‡∏•‡∏≤ : {EVENT.RECOVERY.TIME}
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà : {EVENT.RECOVERY.DATE} 
            ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: {EVENT.DURATION}
            
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° :
            {$ZABBIX.URL}/tr_events.php?triggerid={TRIGGER.ID}&eventid={EVENT.ID}
